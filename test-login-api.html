<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XDrive Login - Test API Direct</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            padding: 40px;
        }
        h1 {
            color: #C8A64D;
            margin-bottom: 10px;
            font-size: 32px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .test-card {
            padding: 25px;
            background: #f9f9f9;
            border-radius: 12px;
            border-left: 4px solid #C8A64D;
        }
        .test-card h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .status-box {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 14px;
            line-height: 1.6;
        }
        .status-box.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status-box.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status-box.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .status-box.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .status-box.pending {
            background: #e7f3ff;
            color: #004085;
            border: 1px solid #b8daff;
        }
        button {
            background: #C8A64D;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin: 5px 5px 5px 0;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        button:hover {
            background: #B39543;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(200, 166, 77, 0.3);
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            margin: 10px 0;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-top: 30px;
        }
        .summary-card h2 {
            margin-bottom: 15px;
            font-size: 24px;
        }
        .test-results {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        .result-item {
            text-align: center;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
        }
        .result-item .icon {
            font-size: 32px;
            margin-bottom: 8px;
        }
        .result-item .label {
            font-size: 12px;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê XDrive Logistics</h1>
        <p class="subtitle">Test Complet Func»õionalitate Autentificare</p>

        <div class="test-grid">
            <!-- Test 1 -->
            <div class="test-card">
                <h2>üåê Test 1: Conexiune API</h2>
                <button onclick="testAPIConnection()">üöÄ TesteazƒÉ Conexiune</button>
                <div id="test1-result"></div>
            </div>

            <!-- Test 2 -->
            <div class="test-card">
                <h2>‚ùå Test 2: Creden»õiale Invalide</h2>
                <button onclick="testInvalidCredentials()">üß™ TesteazƒÉ Respingere</button>
                <div id="test2-result"></div>
            </div>
        </div>

        <!-- Test 3 - Full Width -->
        <div class="test-card" style="margin-bottom: 20px;">
            <h2>‚úÖ Test 3: Login Real (NecesitƒÉ Creden»õiale)</h2>
            <p style="font-size: 13px; color: #666; margin-bottom: 15px;">
                ‚ö†Ô∏è Folose»ôte creden»õiale reale pentru a testa login-ul complet
            </p>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 500; font-size: 14px;">Email:</label>
                    <input type="email" id="email" placeholder="your@email.com" 
                           style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 500; font-size: 14px;">ParolƒÉ:</label>
                    <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                           style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                </div>
            </div>
            <button onclick="testRealLogin()">üîì Login</button>
            <button onclick="testLogout()" style="background: #dc3545;">üö™ Logout</button>
            <button onclick="checkSession()" style="background: #6c757d;">üîç VerificƒÉ Sesiune</button>
            <div id="test3-result"></div>
        </div>

        <!-- Test 4 -->
        <div class="test-card">
            <h2>‚ôªÔ∏è Test 4: Persisten»õƒÉ Sesiune</h2>
            <button onclick="testSessionPersistence()">üîÑ VerificƒÉ Persisten»õƒÉ</button>
            <p style="font-size: 12px; color: #666; margin-top: 10px;">
                üí° DupƒÉ login, re√ÆmprospƒÉteazƒÉ pagina pentru a verifica persisten»õa
            </p>
            <div id="test4-result"></div>
        </div>

        <!-- Summary -->
        <div class="summary-card">
            <h2>üìä Rezumat Teste</h2>
            <div class="test-results">
                <div class="result-item">
                    <div class="icon" id="icon1">‚è≥</div>
                    <div class="label">Conexiune</div>
                </div>
                <div class="result-item">
                    <div class="icon" id="icon2">‚è≥</div>
                    <div class="label">Validare</div>
                </div>
                <div class="result-item">
                    <div class="icon" id="icon3">‚è≥</div>
                    <div class="label">Autentificare</div>
                </div>
                <div class="result-item">
                    <div class="icon" id="icon4">‚è≥</div>
                    <div class="label">Persisten»õƒÉ</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://jqxlauexhkonixtjvljw.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpxeGxhdWV4aGtvbml4dGp2bGp3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzU5MjI2ODUsImV4cCI6MjA1MTQ5ODY4NX0.YJrN5WBcWZxONXiDk_sIVpK1O0yPAqGMV3C27eHsm5c';

        function showResult(id, html, type = 'info') {
            document.getElementById(id).innerHTML = `<div class="status-box ${type}">${html}</div>`;
        }

        function updateIcon(iconId, emoji) {
            document.getElementById(iconId).textContent = emoji;
        }

        async function testAPIConnection() {
            showResult('test1-result', '‚è≥ Testare conexiune...', 'pending');
            
            try {
                const response = await fetch(`${SUPABASE_URL}/auth/v1/health`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    showResult('test1-result', 
                        `‚úÖ <strong>Conexiunea func»õioneazƒÉ perfect!</strong><br>
                        <div class="code-block">Status: ${response.status} OK
Server: Supabase Auth
Response: ${JSON.stringify(data, null, 2)}</div>`, 
                        'success');
                    updateIcon('icon1', '‚úÖ');
                } else {
                    throw new Error(`Status: ${response.status}`);
                }
            } catch (error) {
                showResult('test1-result', 
                    `‚ùå <strong>Eroare conexiune:</strong><br>${error.message}`, 
                    'error');
                updateIcon('icon1', '‚ùå');
            }
        }

        async function testInvalidCredentials() {
            showResult('test2-result', '‚è≥ Testare creden»õiale invalide...', 'pending');
            
            try {
                const response = await fetch(`${SUPABASE_URL}/auth/v1/token?grant_type=password`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: 'invalid@test.com',
                        password: 'wrongpassword123'
                    })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    showResult('test2-result', 
                        `‚úÖ <strong>Sistemul respinge corect creden»õialele invalide!</strong><br>
                        <div class="code-block">Status: ${response.status}
Error: ${data.error_description || data.error || data.message}</div>`, 
                        'success');
                    updateIcon('icon2', '‚úÖ');
                } else {
                    showResult('test2-result', 
                        `‚ùå <strong>PROBLEMƒÇ:</strong> Creden»õialele invalide au fost acceptate!`, 
                        'error');
                    updateIcon('icon2', '‚ùå');
                }
            } catch (error) {
                showResult('test2-result', 
                    `‚úÖ Eroare prinsƒÉ corect: ${error.message}`, 
                    'success');
                updateIcon('icon2', '‚úÖ');
            }
        }

        async function testRealLogin() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                showResult('test3-result', '‚ö†Ô∏è Te rog completeazƒÉ email »ôi parolƒÉ', 'warning');
                return;
            }
            
            showResult('test3-result', '‚è≥ Autentificare √Æn curs...', 'pending');
            
            try {
                const response = await fetch(`${SUPABASE_URL}/auth/v1/token?grant_type=password`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (response.ok && data.access_token) {
                    // Store tokens in localStorage (for session persistence)
                    localStorage.setItem('supabase.auth.token', JSON.stringify({
                        access_token: data.access_token,
                        refresh_token: data.refresh_token,
                        user: data.user
                    }));
                    
                    showResult('test3-result', 
                        `‚úÖ <strong>LOGIN REU»òIT!</strong><br>
                        <div class="code-block">User ID: ${data.user.id}
Email: ${data.user.email}
Role: ${data.user.role}
Expires: ${new Date(data.expires_at * 1000).toLocaleString('ro-RO')}</div>
                        <strong>üéâ Utilizatorul este acum logat!</strong>`, 
                        'success');
                    updateIcon('icon3', '‚úÖ');
                } else {
                    showResult('test3-result', 
                        `‚ùå <strong>Eroare autentificare:</strong><br>
                        ${data.error_description || data.message || 'Creden»õiale invalide'}`, 
                        'error');
                    updateIcon('icon3', '‚ùå');
                }
            } catch (error) {
                showResult('test3-result', 
                    `‚ùå <strong>Eroare:</strong> ${error.message}`, 
                    'error');
                updateIcon('icon3', '‚ùå');
            }
        }

        async function checkSession() {
            showResult('test3-result', '‚è≥ Verificare sesiune...', 'pending');
            
            const stored = localStorage.getItem('supabase.auth.token');
            
            if (!stored) {
                showResult('test3-result', 
                    '‚ö™ <strong>Nu existƒÉ sesiune activƒÉ</strong><br>Te rog sƒÉ te loghezi mai √Ænt√¢i.', 
                    'info');
                return;
            }
            
            try {
                const tokenData = JSON.parse(stored);
                
                // Verify token with Supabase
                const response = await fetch(`${SUPABASE_URL}/auth/v1/user`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${tokenData.access_token}`
                    }
                });
                
                if (response.ok) {
                    const user = await response.json();
                    showResult('test3-result', 
                        `‚úÖ <strong>Sesiune ValidƒÉ!</strong><br>
                        <div class="code-block">User: ${user.email}
ID: ${user.id}
Status: Activ</div>`, 
                        'success');
                    updateIcon('icon3', '‚úÖ');
                } else {
                    showResult('test3-result', 
                        `‚ö†Ô∏è Sesiunea a expirat sau este invalidƒÉ`, 
                        'warning');
                    localStorage.removeItem('supabase.auth.token');
                }
            } catch (error) {
                showResult('test3-result', 
                    `‚ùå Eroare: ${error.message}`, 
                    'error');
            }
        }

        async function testLogout() {
            localStorage.removeItem('supabase.auth.token');
            showResult('test3-result', 
                '‚úÖ <strong>Deconectat cu succes!</strong><br>Sesiunea a fost »ôtearsƒÉ din localStorage.', 
                'success');
            updateIcon('icon3', '‚ö™');
        }

        async function testSessionPersistence() {
            showResult('test4-result', '‚è≥ Verificare persisten»õƒÉ...', 'pending');
            
            const stored = localStorage.getItem('supabase.auth.token');
            
            if (!stored) {
                showResult('test4-result', 
                    `‚ö™ <strong>Nu existƒÉ sesiune pentru a testa</strong><br>
                    Te rog sƒÉ te loghezi mai √Ænt√¢i √Æn Test 3.`, 
                    'info');
                updateIcon('icon4', '‚ö™');
                return;
            }
            
            try {
                const tokenData = JSON.parse(stored);
                
                // Verify that session persists
                const response = await fetch(`${SUPABASE_URL}/auth/v1/user`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${tokenData.access_token}`
                    }
                });
                
                if (response.ok) {
                    showResult('test4-result', 
                        `‚úÖ <strong>Sesiunea PERSISTƒÇ corect!</strong><br>
                        <div class="code-block">‚úì Token salvat √Æn localStorage
‚úì Token valid la verificare
‚úì Utilizator autentificat</div>
                        <strong>üí° √éncearcƒÉ sƒÉ re√ÆmprospƒÉtezi pagina - sesiunea va persista!</strong>`, 
                        'success');
                    updateIcon('icon4', '‚úÖ');
                } else {
                    showResult('test4-result', 
                        `‚ö†Ô∏è Sesiunea nu mai este validƒÉ`, 
                        'warning');
                    updateIcon('icon4', '‚ö†Ô∏è');
                }
            } catch (error) {
                showResult('test4-result', 
                    `‚ùå Eroare: ${error.message}`, 
                    'error');
                updateIcon('icon4', '‚ùå');
            }
        }

        // Auto-check session on page load
        window.addEventListener('load', () => {
            console.log('üîç XDrive Login Test - Pagina √ÆncƒÉrcatƒÉ');
            
            // Auto-test connection
            testAPIConnection();
            
            // Check if there's an existing session
            const stored = localStorage.getItem('supabase.auth.token');
            if (stored) {
                showResult('test3-result', 
                    'üîÑ <strong>Sesiune detectatƒÉ din vizitƒÉ anterioarƒÉ</strong><br>ApasƒÉ "VerificƒÉ Sesiune" pentru a valida.', 
                    'info');
            }
        });
    </script>
</body>
</html>
