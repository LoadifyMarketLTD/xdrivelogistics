[build]
  command = "npm run build:all"
  publish = "dist"
  
[build.environment]
  NODE_VERSION = "20"
  NPM_FLAGS = "--legacy-peer-deps"

# Next.js plugin - auto-detects .next/ directory
[[plugins]]
  package = "@netlify/plugin-nextjs"

# Rewrite portal routes to Next.js function
[[redirects]]
  from = "/login"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/register"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/dashboard"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/dashboard/*"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/forgot-password"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/reset-password"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/onboarding"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/onboarding/*"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/company/*"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/loads"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/loads/*"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/jobs"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/jobs/*"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/invoices"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/invoices/*"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/users"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/users/*"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/my-fleet"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/my-fleet/*"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/drivers-vehicles"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/drivers-vehicles/*"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/directory"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/directory/*"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/quotes"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/quotes/*"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/diary"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/diary/*"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/m"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/m/*"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/diagnostics"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/live-availability"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/return-journeys"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

[[redirects]]
  from = "/freight-vision"
  to = "/.netlify/functions/___netlify-handler"
  status = 200

# SPA fallback for landing page (everything else)
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
